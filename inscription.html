<!DOCTYPE html>
<html> 
    <head>
        <meta charset="utf-8">
        <title> Lightning School</title>
        <script src="js/jquery-3.4.0.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/style.css">
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    </head>
    <body class="text-center">
        <form id="inscription" role="form" data-toggle="validator" class="form-inscription">
            <img class="mb-4" src="assets/logo.png" alt="" width="72" height="72">
            <h1 class="h3 mb-3 font-weight-normal">Créer un compte </h1>
            <div class="form-group">
                <label for="inputEmail" class="sr-only">Email address</label>
                    <input type="email" id="inputEmail" class="form-control" placeholder="E-mail" required autofocus>
                <label for="inputPassword" class="sr-only">Password</label>
            </div>
            <div class="form-group">
                <input type="password" id="inputPassword" class="form-control" maxlength="32" minlength="8" placeholder="Mot de passe" required>
            </div>
            <div class="form-group">
                    <input type="password" id="inputPasswordConfirm" class="form-control" data-match="#inputPassword" data-match-error="mot de passe différents !" placeholder="Confirme mot de passe" required>
                    <div id="msgError" class="help-block" >Les deux mots de passe sont différents</div>
            </div>
            <div class="form-check-inline">
                <input class="form-check-input" type="radio" name="RadioStudent" id="RadioStudent" value="option1" checked>
                <label class="form-check-label" for="RadioStudent">Etudiant</label>
            </div>
            <div class="form-check-inline">
                <input class="form-check-input" type="radio" name="Radio2" id="Radio2" value="option2">
                <label class="form-check-label" for="Radio2">Professeur</label>
            </div>   
            
                
            <button type="submit" class="btn btn-lg btn-primary btn-block" >Submit</button>   
            <button id="retour" type="button" class="btn btn-link">Retour</button>
        </form> 
    </body>
    <script>
        $( "#retour" ).click(function() {
            Cookies.remove('LS_user_admin');
            Cookies.remove('LS_token_admin');
            document.location.href='connexion.html?'
        });
        jQuery(function($) {
            $("#inscription").submit(function(e) {
                var password1 = $("#inputPassword").val();
                var password2 = $("#inputPasswordConfirm").val();
                e.preventDefault();
                if (password1!=password2) {
                    $("#msgError").show();
                }
                else{                  
                    var password = $("#inputPassword").val();
                    var login = $("#inputEmail").val();
                    var typeUser ;
                    if($('#RadioStudent').is(':checked')){typeUser="STUDENT";}
                    else{typeUser="TEACHER";}
                    e.preventDefault();
                    var jwt= Cookies.get('LS_token_admin');
                    console.log("jwt :"+jwt);
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "http://ec2-35-180-196-86.eu-west-3.compute.amazonaws.com/api/users", true);
                    xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                    xhr.setRequestHeader('Authorization',jwt);
                    xhr.send(JSON.stringify({"mail" : login, "password" : password, "typeUser" : typeUser}));
                    xhr.onreadystatechange = function() {
                        if(xhr.readyState == 4){
                            if(xhr.status == 201) {
                                console.log(xhr.responseText);
                                alert("création succes !" );
                                Cookies.remove('LS_user_admin');
                                Cookies.remove('LS_token_admin');
                                window.location="connexion.html?";
                            }
                            else if (xhr.status == 403){ 
                                console.log(xhr.status);                              
                                console.log(xhr.statusText);
                                console.log(xhr.text);
                                alert("acces interdit " );
                            }else if (xhr.status == 500){ 
                                console.log(xhr.status);                              
                                console.log(xhr.statusText);
                                console.log(xhr.text);
                                alert("erreur serveur " );
                            }
                            else { 
                                console.log(xhr.status);                              
                                console.log(xhr.statusText);
                                console.log(xhr.text);
                                alert("erreur inconnue " );
                            }
                        }
                    }; 
                }                              
            });    
        });      
    </script>   
</html>